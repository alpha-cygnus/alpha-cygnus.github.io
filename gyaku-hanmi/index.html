<html>
<head>
	<meta charset="utf-8"> 
	<title>G-H</title>
</head>
<script src="http://code.jquery.com/jquery-1.11.0.js"></script>
<script src="../lib/peg-0.8.0.js"></script>
<script src="../lib/oo.js"></script>
<script src="../lib/gg.js"></script>
<script src="rr.js"></script>
<script>
	var GH; // = module.exports;
	$.get('gh.pegjs', function(data) {
		console.log(data);
		GH = PEG.buildParser(data);
		$.get('ai.gh', function(data) {
			console.log(data);
			try {
				var parsed = GH.parse(data);
				onParseGH(parsed);
			} catch(e) {
				console.error(e);
			}
		}, 'text');
	});
	
	function flatten(list) {
		if ($.isArray(list)) {
			return $.map(list, flatten);
		}
		return list;
	}

	function onParseGH(parsed) {
		//console.log(JSON.stringify(parsed, null, '   '));
		var start;
		for (var i = 0; i < parsed.length; i++) {
			var rule = OO.fromList(parsed[i]);
			start = start || rule;
		};
		console.log(GG.rules);
		for (var i = 0; i < 10; i++) {
			var s = flatten(start.generate({})).join(' ');
			var r = RR.hepburn2polivanov(s);
			$('#tlist').append($('<li>').html(s + ' - ' + r));
		}
	}
</script>
<body>
	<ul id="tlist">
	</ul>

</body>
</html>